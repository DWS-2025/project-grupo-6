<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review Management</title>
    <link rel="stylesheet" href="/css/header.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="/css/review-management.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    {{> common/header}}
    
    <div class="container">
        {{#successMessage}}
            <div class="alert alert-success">{{successMessage}}</div>
        {{/successMessage}}
        {{#errorMessage}}
            <div class="alert alert-danger">{{errorMessage}}</div>
        {{/errorMessage}}
        <!-- Header Section -->
        <div class="header-section">
            <div class="header-content">
                <div class="header-text">
                    <h1 class="page-title">
                        <span class="title-icon">
                            <i class="fas fa-star"></i>
                        </span>
                        Review Management
                    </h1>
                    <p class="page-subtitle">Moderate and manage customer reviews across your platform</p>
                </div>
                <div class="header-stats">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-comments"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-number" id="totalReviews">0</span>
                            <span class="stat-label">Total Reviews</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Content Section -->
        <div class="content-section">
            <div class="controls-header">
                <h2 class="controls-title">
                    <i class="fas fa-filter"></i>
                    View Options
                </h2>
                <div class="view-toggle">
                    <button class="toggle-btn active" data-view="users">
                        <span class="btn-icon">
                            <i class="fas fa-users"></i>
                        </span>
                        <span class="btn-text">By Users</span>
                    </button>
                    <button class="toggle-btn" data-view="products">
                        <span class="btn-icon">
                            <i class="fas fa-box"></i>
                        </span>
                        <span class="btn-text">By Products</span>
                    </button>
                </div>
            </div>

            <!-- Users View -->
            <div class="view-container users-view active">
                {{#users.size}}
                    {{#users}}
                        <div class="review-group-card">
                            <div class="group-header" onclick="toggleGroup(this)">
                                <div class="group-info">
                                    <div class="group-avatar" data-initial="{{#firstName}}{{.}}{{/firstName}}"></div>
                                    <div class="group-details">
                                        <h3 class="group-name">{{firstName}} {{lastName}}</h3>
                                        <div class="group-meta">
                                            <span class="review-count">
                                                <i class="fas fa-comment-dots"></i>
                                                <span class="review-count-number">0</span> reviews
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="toggle-indicator">
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                            </div>
                            
                            <div class="reviews-container">
                                {{#reviews}}
                                    <div class="review-item">
                                        <div class="review-header">
                                            <div class="review-rating" data-rating="{{rating}}">
                                                <!-- Stars will be generated by JavaScript -->
                                            </div>
                                            <div class="review-date">
                                                <i class="far fa-clock"></i>
                                                <span>Recently</span>
                                            </div>
                                        </div>
                                        
                                        <div class="review-content">
                                            <div class="review-text">{{{comment}}}</div>
                                            <div class="review-product-info">
                                                <i class="fas fa-tag"></i>
                                                <span>Product: <strong>{{product.name}}</strong></span>
                                            </div>
                                        </div>
                                        
                                        <div class="review-actions">
                                            <form class="delete-form" action="/delete-review-admin" method="POST">
                                                <input type="hidden" name="productId" value="{{product.id}}">
                                                <input type="hidden" name="reviewId" value="{{id}}">
                                                <button type="button" class="action-btn delete-btn">
                                                    <i class="fas fa-trash-alt"></i>
                                                    <span>Delete</span>
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                {{/reviews}}
                                {{^reviews}}
                                    <div class="empty-reviews">
                                        <div class="empty-icon">
                                            <i class="fas fa-comment-slash"></i>
                                        </div>
                                        <p class="empty-text">No reviews from this user</p>
                                    </div>
                                {{/reviews}}
                            </div>
                        </div>
                    {{/users}}
                {{/users.size}}
                
                {{^users.size}}
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-users-slash"></i>
                        </div>
                        <h3 class="empty-title">No Users with Reviews</h3>
                        <p class="empty-description">There are no users with reviews in the system yet</p>
                    </div>
                {{/users.size}}
            </div>
            
            <!-- Products View -->
            <div class="view-container products-view">
                {{#products.size}}
                    {{#products}}
                        <div class="review-group-card">
                            <div class="group-header" onclick="toggleGroup(this)">
                                <div class="group-info">
                                    {{#imagePath}}
                                        <img src="/image/{{id}}" alt="{{name}}" class="group-product-image">
                                    {{/imagePath}}
                                    {{^imagePath}}
                                        <div class="group-avatar product-avatar">
                                            <i class="fas fa-box"></i>
                                        </div>
                                    {{/imagePath}}
                                    <div class="group-details">
                                        <h3 class="group-name">{{name}}</h3>
                                        <div class="group-meta">
                                            <span class="review-count">
                                                <i class="fas fa-comment-dots"></i>
                                                <span class="review-count-number">0</span> reviews
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="toggle-indicator">
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                            </div>
                            
                            <div class="reviews-container">
                                {{#reviews}}
                                    <div class="review-item">
                                        <div class="review-header">
                                            <div class="review-user">
                                                <div class="user-avatar" data-initial="{{#user.firstName}}{{.}}{{/user.firstName}}"></div>
                                                <span class="user-name">{{user.firstName}} {{user.lastName}}</span>
                                            </div>
                                            <div class="review-rating" data-rating="{{rating}}">
                                                <!-- Stars will be generated by JavaScript -->
                                            </div>
                                            <div class="review-date">
                                                <i class="far fa-clock"></i>
                                                <span>Recently</span>
                                            </div>
                                        </div>
                                        
                                        <div class="review-content">
                                            <div class="review-text">{{{comment}}}</div>
                                        </div>
                                        
                                        <div class="review-actions">
                                            <form class="delete-form" action="/delete-review-admin" method="POST">
                                                <input type="hidden" name="productId" value="{{product.id}}">
                                                <input type="hidden" name="reviewId" value="{{id}}">
                                                <button type="button" class="action-btn delete-btn">
                                                    <i class="fas fa-trash-alt"></i>
                                                    <span>Delete</span>
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                {{/reviews}}
                                {{^reviews}}
                                    <div class="empty-reviews">
                                        <div class="empty-icon">
                                            <i class="fas fa-comment-slash"></i>
                                        </div>
                                        <p class="empty-text">No reviews for this product</p>
                                    </div>
                                {{/reviews}}
                            </div>
                        </div>
                    {{/products}}
                {{/products.size}}
                
                {{^products.size}}
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-box-open"></i>
                        </div>
                        <h3 class="empty-title">No Products with Reviews</h3>
                        <p class="empty-description">There are no products with reviews in the system yet</p>
                    </div>
                {{/products.size}}
            </div>
        </div>
    </div>

    {{> common/footer}}
    
    <script src="/js/review-management.js"></script>
</body>
</html> 